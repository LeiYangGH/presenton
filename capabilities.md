# PresentOn 项目能力分析

## 概述

PresentOn 是一个基于AI的PPT生成系统，通过LLM（大语言模型）根据用户输入生成演示文稿。本文档基于源码分析，详细梳理了PPT生成从头到尾的流程，明确区分了用户可控资源和LLM生成内容。

## PPT生成完整流程

### 1. 初始输入阶段 (用户可控)

#### 1.1 文本输入
- **位置**: `upload/components/UploadPage.tsx`
- **用户可控**: ✅ 完全可控
  - 主要提示文本 (prompt)
  - 语言选择 (已修改为仅支持英文和简体中文，默认中文)
  - 幻灯片数量 (已修改为默认5页，最小值)
  - 高级设置：语气、详细程度、特殊指令、目录、标题页、网络搜索

#### 1.2 文档上传
- **位置**: `upload/components/SupportingDoc.tsx`
- **用户可控**: ✅ 完全可控
- **支持格式**: 
  - PDF (限制：只能有一个PDF文件)
  - TXT (文本文件)
  - PPTX (PowerPoint演示文稿)
  - DOCX (Word文档)
- **限制**: 
  - ❌ 不支持单独的图片、视频、音频上传
  - ❌ 不支持自定义样式文件上传
  - ❌ 不支持模板文件上传

### 2. 大纲生成阶段 (LLM主导)

#### 2.1 文档处理
- **位置**: `PresentationGenerationApi.uploadDoc()` 和 `decomposeDocuments()`
- **处理方式**: 
  - 上传的文档被分解为内容片段
  - PDF/DOCX通过OCR或文本提取处理
  - 内容被用作LLM生成上下文

#### 2.2 大纲生成
- **位置**: `PresentationGenerationApi.createPresentation()`
- **LLM职责**: 
  - 基于用户提示和上传文档内容生成幻灯片大纲
  - 决定每页幻灯片的标题和主要内容结构
  - 生成图表配置和数据建议

### 3. 模板选择阶段 (用户+LLM混合)

#### 3.1 内置模板系统
- **位置**: `presentation-templates/index.tsx`
- **模板类型**: 
  - General (13种布局)
  - Neo-General (30种布局) 
  - Modern (11种布局)
  - Neo-Modern (18种布局)
  - Standard (12种布局)
  - Neo-Standard (18种布局)
  - Swift (10种布局)
  - Neo-Swift (16种布局)

#### 3.2 模板选择机制
- **用户可控**: ✅ 部分可控
  - 用户可以从预设模板中选择整体风格
  - 用户无法自定义模板布局
  - 用户无法上传自定义模板

#### 3.3 自定义AI模板
- **位置**: `outline/components/TemplateSelection.tsx`
- **当前状态**: ❌ 功能不完整
  - 代码中存在"Custom AI Templates"部分
  - 但实际显示"No custom templates yet"
  - 无模板创建或上传接口

### 4. 幻灯片内容生成阶段 (LLM主导)

#### 4.1 内容生成
- **位置**: `utils/llm_calls/generate_slide_content.py`
- **LLM职责**: 
  - 根据大纲和模板schema生成具体内容
  - 生成文本内容、图表数据、图片提示词
  - 填充模板的预定义字段

#### 4.2 布局约束
- **LLM限制**: 
  - 必须严格遵循选定模板的JSON schema
  - 无法改变模板的基本布局结构
  - 只能在预定义字段内填充内容

### 5. 幻灯片编辑阶段 (用户+LLM混合)

#### 5.1 编辑界面
- **位置**: `outline/components/OutlineItem.tsx`
- **用户可控**: ✅ 内容层面可控
  - 使用MarkdownEditor直接编辑幻灯片内容
  - 可以删除、重排序幻灯片
  - 可以通过自然语言指令要求LLM修改

#### 5.2 LLM编辑机制
- **位置**: `utils/llm_calls/edit_slide.py`
- **LLM编辑能力**: 
  - **文本内容**: ✅ 可以修改
  - **图片提示词**: ✅ 可以生成/修改
  - **图标查询**: ✅ 可以生成/修改
  - **布局结构**: ❌ 无法修改
  - **模板类型**: 通过`select_slide_type_on_edit.py`可以切换

#### 5.3 编辑限制分析
- **问题根源**: 
  - LLM编辑时严格遵循模板schema
  - 布局相关的字段不在编辑范围内
  - "左右交换文本和图片位置"需要切换到不同的布局模板

### 6. 最终输出阶段

#### 6.1 PPTX生成
- **位置**: `services/pptx_presentation_creator.py`
- **处理方式**: 
  - 基于填充好的模板数据生成PPTX文件
  - 调用外部库(如python-pptx)进行渲染

## 用户可控资源总结

### ✅ 用户可直接准备的资源

1. **文本内容**
   - 主要提示文本
   - 特殊指令
   - 上传的文档内容(PDF, DOCX, TXT, PPTX)

2. **基本配置**
   - 语言选择(英文/中文)
   - 幻灯片数量(5-20页)
   - 语气和详细程度设置

3. **内容编辑**
   - 大纲阶段的Markdown编辑
   - 幻灯片内容的直接文本编辑
   - 自然语言编辑指令

4. **模板选择**
   - 从130+种内置布局中选择
   - 选择整体演示文稿风格

### ❌ 用户无法直接准备的资源

1. **媒体文件**
   - 单独的图片、视频、音频文件
   - 自定义图标库
   - 品牌素材包

2. **样式定制**
   - 自定义颜色主题
   - 字体设置
   - 布局模板设计

3. **模板系统**
   - 上传自定义模板
   - 修改现有模板布局
   - 创建新的布局类型

## LLM生成内容总结

### ✅ LLM主要生成的内容

1. **结构规划**
   - 幻灯片大纲
   - 内容组织逻辑
   - 页面顺序安排

2. **文本内容**
   - 幻灯片标题和正文
   - 演讲者备注
   - 项目符号列表

3. **数据可视化**
   - 图表数据建议
   - 图表类型选择
   - 数据标签和说明

4. **媒体建议**
   - 图片生成提示词
   - 图标搜索查询
   - 视觉元素建议

### ⚠️ LLM受限的内容

1. **布局结构**
   - 严格遵循模板schema
   - 无法创新布局设计
   - 位置调整受限

2. **样式定制**
   - 颜色、字体等样式属性
   - 品牌元素应用
   - 视觉一致性控制

## 关键问题分析

### 问题1: 布局修改无效
**现象**: 用户要求"左右交换文本和图片位置"，LLM答应但实际未改变

**原因**: 
- LLM编辑时只能修改内容字段，不能修改布局结构
- 布局交换需要切换到不同的模板布局
- `edit_slide.py`中明确限制"Do not change **Image prompts** and **Icon queries** if not asked for in prompt"

**解决方案**: 
- 需要通过`select_slide_type_on_edit.py`切换到相应布局
- 或者增加更多布局变体模板

### 问题2: 缺少媒体上传
**现象**: 只能上传文档，不能上传图片、视频等素材

**当前限制**: 
- `SupportingDoc.tsx`中硬编码了文件类型限制
- 系统设计假设所有媒体由LLM生成提示词后搜索

**影响**: 
- 无法使用特定的品牌图片
- 无法插入预制的图表或数据可视化
- 无法使用自定义图标库

### 问题3: 模板系统不完整
**现象**: 自定义模板功能存在但不可用

**现状**: 
- 有"Custom AI Templates"界面但无实际功能
- 无模板创建接口或文档
- 无模板上传机制

## 建议改进方向

### 1. 增强媒体上传支持
- 扩展SupportingDoc组件支持图片、视频上传
- 增加媒体库管理功能
- 允许用户指定使用上传的媒体

### 2. 完善模板系统
- 实现自定义模板创建功能
- 提供模板开发文档和规范
- 支持模板上传和分享

### 3. 改进编辑体验
- 增加可视化布局编辑器
- 允许拖拽调整元素位置
- 提供更直观的样式定制

### 4. 优化LLM交互
- 改进布局切换机制
- 增强编辑指令的理解能力
- 提供更准确的编辑反馈

## 技术架构总结

```
用户输入 → 文档处理 → 大纲生成 → 模板选择 → 内容生成 → 用户编辑 → 最终输出
    ↓           ↓         ↓         ↓         ↓         ↓         ↓
  用户可控    LLM处理   LLM主导   用户选择   LLM填充   用户主导   系统渲染
```

**核心设计理念**: 
- 用户负责**内容和方向**
- LLM负责**结构和生成**
- 模板系统负责**样式和布局**
- 编辑系统负责**调整和优化**

这种设计在保证易用性的同时，也在某些方面限制了用户的自定义能力。理解这些限制有助于更好地使用系统或进行功能扩展。
